<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Supervisor Dashboard</title>
    <link rel="stylesheet" href="supervisor.style.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <h1>Supervisor Dashboard</h1>

    <!-- supervisorAuthSection REMOVED -->

    <div id="supervisorMainContent"> <!-- No longer hidden by default -->
        <!-- Logged in as and logout button REMOVED -->
        <hr>
        <h2>Inspections Overview</h2>
        <button id="refreshBtn">Refresh List</button>
        <div id="loadingStatus">Loading inspections...</div>
        <table id="inspectionsTable">
            <thead>
                <tr>
                    <th>Project #</th>
                    <th>Insp. Date</th>
                    <th>County</th>
                    <th>Lat/Lon</th>
                    <th>Logger</th>
                    <th>Acreage</th>
                    <th>BMPs Met?</th>
                    <th>Map</th>
                    <th>Notes</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="inspectionsTableBody"></tbody>
        </table>
    </div>

    <dialog id="editModal">
        <form id="editForm">
            <h2>Edit Inspection & Project Details</h2>
            <input type="hidden" id="editInspectionId">
            <input type="hidden" id="editProjectId">
            <fieldset>
                <legend>Project Details (Editable)</legend>
                <label for="editProjectNumber">Project Number:</label>
                <input type="text" id="editProjectNumber" required><br>
                <label for="editLatitude">Latitude:</label>
                <input type="number" step="any" id="editLatitude" required><br>
                <label for="editLongitude">Longitude:</label>
                <input type="number" step="any" id="editLongitude" required><br>
            </fieldset>
            <hr>
            <fieldset>
                <legend>Inspection Details (Editable)</legend>
                <label for="editLoggerName">Logger Name:</label>
                <input type="text" id="editLoggerName" required><br>
                <label for="editAcreage">Acreage:</label>
                <input type="number" step="0.1" id="editAcreage" required><br>
                <label for="editInspectionDate">Inspection Date/Time:</label>
                <input type="datetime-local" id="editInspectionDate" required><br>
                <fieldset class="inner-fieldset">
                    <legend>BMPs Met?</legend>
                    <label><input type="radio" name="editBmpsMet" value="true" required> Yes</label>
                    <label><input type="radio" name="editBmpsMet" value="false"> No</label>
                </fieldset>
                <label for="editNotes">Notes:</label><br>
                <textarea id="editNotes" rows="3"></textarea><br>
                <p><strong>Map Image:</strong>
                    <a id="editMapLink" href="#" target="_blank" rel="noopener noreferrer">View Current Map</a>
                    <span id="noMapText" class="hidden">(No map uploaded)</span>
                </p>
            </fieldset>
            <div class="modal-actions">
                <button type="submit" id="saveEditBtn">Save Changes</button>
                <button type="button" id="cancelEditBtn">Cancel</button>
            </div>
            <div id="editStatus"></div>
        </form>
    </dialog>

    <script>
        // Inline script to ensure Supabase is available before supervisor.app.js runs its main logic
        function initializeSupervisorApp() {
            if (typeof window.runSupervisorApp === 'function') {
                window.runSupervisorApp();
            } else {
                console.error('runSupervisorApp function not found in supervisor.app.js');
            }
        }

        if (typeof Supabase !== 'undefined' && typeof Supabase.createClient === 'function') {
            const supervisorAppScript = document.createElement('script');
            supervisorAppScript.src = 'supervisor.app.js';
            supervisorAppScript.onload = initializeSupervisorApp;
            supervisorAppScript.onerror = () => console.error('Failed to load supervisor.app.js');
            document.body.appendChild(supervisorAppScript);
        } else {
            console.error('CRITICAL: Supabase library not loaded. Supervisor App cannot start.');
            alert('Error: Could not connect to backend services for supervisor app. Please try refreshing.');
        }
    </script>
</body>
</html>
