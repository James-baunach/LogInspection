<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Field Project & Inspection</title>
    <link rel="stylesheet" href="style.css">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#3498db"/>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>

    <h1>Field Project & Inspection</h1>

    <div id="authSection">
        <h2>Login / Sign Up</h2>
        <input type="email" id="email" placeholder="Email" required><br>
        <input type="password" id="password" placeholder="Password" required><br>
        <button id="loginBtn">Login</button>
        <button id="signupBtn">Sign Up</button>
        <p id="authStatus"></p>
    </div>

    <div id="passwordChangeSection" class="hidden">
        <h2>Change Password</h2>
        <input type="password" id="currentPassword" placeholder="Current Password" required><br>
        <input type="password" id="newPassword" placeholder="New Password (min 6 chars)" required><br>
        <input type="password" id="confirmNewPassword" placeholder="Confirm New Password" required><br>
        <button id="updatePasswordBtn">Update Password</button>
        <button id="cancelPasswordChangeBtn">Cancel</button>
        <p id="passwordChangeStatus"></p>
    </div>


    <div id="mainContent" class="hidden">
        <p>Logged in as: <span id="userEmail"></span>
            <button id="logoutBtn">Logout</button>
            <button id="showPasswordChangeBtn">Change Password</button>
        </p>
        <hr>

        <div id="requestSection">
            <h2>1. Request Project Number</h2>
            <label for="countySelect">Select County:</label>
            <select id="countySelect" required>
                <option value="" disabled selected>-- Select County --</option>
                <!-- Options will be populated by JS -->
            </select><br>

            <label for="latitude">Latitude:</label>
            <input type="number" id="latitude" step="any" placeholder="e.g., 37.12345" required><br>

            <label for="longitude">Longitude:</label>
            <input type="number" id="longitude" step="any" placeholder="e.g., -86.54321" required><br>

            <button id="getGpsBtn">Get Current GPS</button>
            <div id="gpsStatus"></div>

            <button id="requestProjectBtn">Get New Project Number</button>
            <div id="requestStatus"></div>
            <div id="requestResult"></div>
        </div>

        <div id="inspectionSection" class="hidden">
            <h2>2. Enter Inspection Details</h2>
            <form id="inspectionForm">
                <input type="hidden" id="projectId">

                <label for="projectNumberDisplay">Project Number:</label>
                <input type="text" id="projectNumberDisplay" readonly disabled><br>

                <label for="acreage">Acreage:</label>
                <input type="number" id="acreage" step="0.1" required><br>

                <label for="loggerName">Logger Name:</label>
                <input type="text" id="loggerName" required><br>

                <label for="inspectionDate">Date/Time:</label>
                <input type="datetime-local" id="inspectionDate" required><br>

                <fieldset>
                    <legend>BMPs Met?</legend>
                    <label><input type="radio" name="bmpsMet" value="true" required> Yes</label>
                    <label><input type="radio" name="bmpsMet" value="false"> No</label>
                </fieldset>

                <label for="mapImage">Upload Map Image (Optional):</label>
                <input type="file" id="mapImage" accept="image/*"><br>
                <img id="imagePreview" src="#" alt="Image Preview" class="hidden" width="100"/>

                <label for="notes">Notes:</label><br>
                <textarea id="notes" rows="4" cols="30"></textarea><br>

                <button type="submit" id="submitInspectionBtn">Upload Inspection Data</button>
                <div id="uploadStatus"></div>
            </form>
            <button id="startNewRequestBtn" class="hidden">Start New Project Request</button>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>